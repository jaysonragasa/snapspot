<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pictxel - Share Your World</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Leaflet.js CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
    
    <!-- Leaflet MarkerCluster CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css" />

    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://css.gg/css?family=Inter:400,500,600,700" rel="stylesheet">
    
    <!-- Custom Styles -->
    <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-gray-100 overflow-hidden">

    <!-- Main Map Container -->
    <div id="map"></div>

    <!-- Header / App Name -->
    <header class="absolute top-0 left-0 right-0 z-20 p-4 flex flex-col items-center gap-4 pointer-events-none">
        <div class="backdrop-blur-lg border border-white/40 rounded-full shadow-lg px-6 py-2 pointer-events-auto hidden">
            <h1 class="text-xl font-bold text-gray-800">Pictxel</h1>
        </div>
        <!-- Search Bar -->
        <div class="relative w-full max-w-md pointer-events-auto">
            <div id="search-container" class="w-full backdrop-blur-lg border border-white/40 rounded-full shadow-lg px-4 py-2 flex items-center gap-2">
                <span id="search-icon-container"></span>
                <input type="text" id="location-search-input" placeholder="Search for a location..." class="w-full bg-transparent outline-none text-gray-800 placeholder-gray-600">
                <button id="header-location-btn" class="p-1 rounded-full hover:bg-white/40 transition-colors">
                     <span id="header-location-icon-container"></span>
                </button>
            </div>
            <div id="search-results" class="absolute top-full mt-2 w-full bg-white/50 backdrop-blur-lg border border-white/40 rounded-xl shadow-lg overflow-hidden hidden z-50">
                <!-- Search results go here -->
            </div>
        </div>
        
        <!-- User Controls -->
        <div class="flex gap-2 pointer-events-auto">
            <button id="auth-btn" class="backdrop-blur-lg border border-white/40 rounded-full shadow-lg px-4 py-2 text-gray-800 hover:bg-white/40 transition-colors">
                Login
            </button>
            <button id="profile-btn" class="backdrop-blur-lg border border-white/40 rounded-full shadow-lg px-4 py-2 text-gray-800 hover:bg-white/40 transition-colors hidden">
                Profile
            </button>
        </div>
    </header>

     <!-- Notification Bar -->
    <div id="notification-bar" class="fixed left-0 right-0 z-50 flex justify-center">
        <div class="backdrop-blur-lg bg-white/50 border border-white/40 rounded-full shadow-lg px-4 pl-6 py-2 flex items-center gap-4">
            <p id="notification-message" class="text-gray-800 text-center text-sm"></p>
            <button id="close-notification-btn" class="text-gray-500 hover:text-gray-800">
                <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
            </button>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loading-indicator" class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
        <div class="bg-white/90 backdrop-blur-lg rounded-xl p-6 flex items-center gap-4">
            <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"></div>
            <span class="text-gray-800 font-medium">Loading...</span>
        </div>
    </div>

    <!-- Bottom Sheet -->
    <div id="bottom-sheet" class="fixed bottom-0 left-0 right-0 z-20 p-4 pointer-events-none">
        <div class="w-full bg-white/50 backdrop-blur-lg border border-white/40 rounded-xl shadow-2xl p-3 pointer-events-auto">
            <div id="bottom-sheet-content" class="flex gap-3 overflow-x-auto pb-2">
                <!-- Virtual scrolling content will be managed by JS -->
            </div>
        </div>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal-transition modal-hidden fixed inset-0 bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-30 p-4">
        <div class="bg-white/50 backdrop-blur-lg border border-white/40 rounded-2xl shadow-2xl p-6 md:p-8 w-full max-w-md mx-auto transform">
            <button id="close-auth-modal" class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 p-2 z-50 min-w-[44px] min-h-[44px] flex items-center justify-center bg-white/80 rounded-full">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            
            <!-- Login Form -->
            <div id="login-form" class="auth-form">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Login</h2>
                <form id="login-form-element">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Email</label>
                            <input type="email" id="login-email" required class="mt-1 block w-full px-3 py-2 bg-white/80 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Password</label>
                            <div class="relative">
                                <input type="password" id="login-password" required class="mt-1 block w-full px-3 py-2 pr-10 bg-white/80 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                <button type="button" id="toggle-login-password" class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                    <svg class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                    </svg>
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Must contain: Uppercase, Lowercase, Number, Special character</p>
                        </div>
                    </div>
                    <button type="submit" class="w-full mt-6 bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg">Login</button>
                </form>
                <p class="text-center mt-4 text-sm text-gray-600">Don't have an account? <button id="show-signup" class="text-blue-500 hover:text-blue-700">Sign up</button></p>
            </div>
            
            <!-- Signup Form -->
            <div id="signup-form" class="auth-form hidden">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Sign Up</h2>
                <form id="signup-form-element">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Name</label>
                            <input type="text" id="signup-name" required class="mt-1 block w-full px-3 py-2 bg-white/80 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Email</label>
                            <input type="email" id="signup-email" required class="mt-1 block w-full px-3 py-2 bg-white/80 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700">Password</label>
                            <div class="relative">
                                <input type="password" id="signup-password" required class="mt-1 block w-full px-3 py-2 pr-10 bg-white/80 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                                <button type="button" id="toggle-signup-password" class="absolute inset-y-0 right-0 pr-3 flex items-center">
                                    <svg class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" />
                                    </svg>
                                </button>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">Must contain: Uppercase, Lowercase, Number, Special character</p>
                        </div>
                    </div>
                    <button type="submit" class="w-full mt-6 bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-4 rounded-lg">Sign Up</button>
                </form>
                <p class="text-center mt-4 text-sm text-gray-600">Already have an account? <button id="show-login" class="text-blue-500 hover:text-blue-700">Login</button></p>
            </div>
        </div>
    </div>

    <!-- User Profile Modal -->
    <div id="profile-modal" class="modal-transition modal-hidden fixed inset-0 bg-black/90 backdrop-blur-sm z-40 p-4 overflow-y-auto">
        <div class="relative w-full max-w-4xl mx-auto pb-24">
            <button id="close-profile-btn" class="fixed top-4 right-4 text-white/80 hover:text-white z-50">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <div class="bg-white/10 backdrop-blur-lg rounded-xl p-6 mt-16">
                <h2 class="text-3xl font-bold text-white text-center mb-6">My Profile</h2>
                <div id="profile-content" class="text-white"></div>
                <div id="user-spots-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4 mt-6"></div>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div id="upload-modal" class="modal-transition modal-hidden fixed inset-0 bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-[9999] p-4">
        <div class="relative bg-white/50 backdrop-blur-lg border border-white/40 rounded-2xl shadow-2xl p-6 md:p-8 w-full max-w-md mx-auto transform">
            
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-gray-800">Share a New Spot</h2>
                <button id="close-modal-button" class="text-gray-500 hover:text-gray-800 p-2 -m-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <form id="upload-form">
                <div class="space-y-4">
                    
                    <!-- File Upload Buttons -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Add a Photo (Optional)</label>
                        <div class="mt-1 grid grid-cols-2 gap-4">
                            <button type="button" id="camera-upload-btn" class="flex flex-col items-center justify-center p-4 bg-white/60 border border-gray-300 rounded-md shadow-sm hover:bg-gray-50/80 transition-colors">
                                <span id="camera-icon-container"></span>
                                <span class="mt-2 text-sm font-medium text-gray-700">Use Camera</span>
                            </button>
                             <button type="button" id="photo-upload-btn" class="flex flex-col items-center justify-center p-4 bg-white/60 border border-gray-300 rounded-md shadow-sm hover:bg-gray-50/80 transition-colors">
                                <span id="photo-icon-container"></span>
                                <span class="mt-2 text-sm font-medium text-gray-700">Upload Photo</span>
                            </button>
                        </div>
                        <input type="file" id="photo" name="photo" accept="image/*" class="hidden">
                        <div id="file-preview" class="mt-2 text-sm text-gray-600"></div>
                    </div>

                    <!-- Uploader's Name -->
                    <div>
                        <label for="uploaderName" class="block text-sm font-medium text-gray-700">Your Name</label>
                        <input type="text" id="uploaderName" name="uploaderName" required placeholder="What should we call you?" class="mt-1 block w-full px-3 py-2 bg-white/80 border border-gray-300 rounded-md shadow-sm placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>

                    <!-- Date -->
                    <div>
                        <label for="spotDate" class="block text-sm font-medium text-gray-700">Date</label>
                        <input type="date" id="spotDate" name="spotDate" required class="mt-1 block w-full px-3 py-2 bg-white/80 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm">
                    </div>
                    
                    <!-- Description -->
                    <div>
                        <label for="description" class="block text-sm font-medium text-gray-700">Description or Note (YouTube links supported)</label>
                        <textarea id="description" name="description" rows="3" required placeholder="Enter your description (YouTube links will be detected automatically)" class="mt-1 block w-full px-3 py-2 bg-white/80 border border-gray-300 rounded-md shadow-sm placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm"></textarea>
                    </div>

                    <!-- Hidden fields for coordinates -->
                    <input type="hidden" id="latitude" name="latitude">
                    <input type="hidden" id="longitude" name="longitude">

                </div>
				<!--<div class="mt-4">
                    <p class="text-xs text-gray-600 text-center">
                        Note: We securely store your uploaded images and never share or sell them to third parties. A watermark with your provided name will be added to each image. Please ensure you have the right to upload the content, as you are responsible for it. The location where you tap on the map is saved to place the spot correctly.
                    </p>
                </div>-->
                <div class="mt-6">
                    <button type="submit" class="w-full bg-blue-500 hover:bg-blue-600 text-white font-bold py-2 px-4 rounded-lg shadow-md focus:outline-none focus:ring-2 focus:ring-blue-400 focus:ring-opacity-75 transition-all duration-150 ease-in-out disabled:bg-gray-400">
                        Upload Spot
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Full-Screen Image Viewer Modal -->
    <div id="image-viewer" class="modal-transition modal-hidden fixed inset-0 bg-black/80 backdrop-blur-sm flex items-center justify-center z-40 p-4">
        <div class="relative w-full h-full flex flex-col items-center justify-center pointer-events-none">
             <button id="close-viewer-btn" class="absolute top-4 right-4 text-white/80 hover:text-white z-50 pointer-events-auto">
                <svg class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <img id="viewer-img" src="" class="max-h-[70%] max-w-[90vw] object-contain rounded-lg shadow-2xl pointer-events-auto">
            <div id="viewer-info" class="w-full max-w-3xl text-white text-center mt-4 p-4 bg-black/40 backdrop-blur-md rounded-lg pointer-events-auto"></div>
        </div>
    </div>

    <!-- Gallery Modal -->
    <div id="gallery-modal" class="modal-transition modal-hidden fixed inset-0 bg-black/90 backdrop-blur-sm z-40 p-4 overflow-y-auto">
        <div class="relative w-full max-w-6xl mx-auto pb-24">
            <button id="close-gallery-btn" class="fixed top-4 right-4 text-white/80 hover:text-white z-50">
                 <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
            <h2 class="text-3xl font-bold text-white text-center my-4">Cluster Gallery</h2>
            <div id="gallery-grid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4"></div>
        </div>
    </div>
    
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    
    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore-compat.js"></script>
    
    <!-- Main Application -->
    <script src="js/app.js"></script>
</body>
</html>